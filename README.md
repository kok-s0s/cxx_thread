# CXX_Thread

## 设计期望

因该线程基类设计出来是为了替代 Qt 的 `QThread`，所以期望的功能如下：

- 信号与槽机制。
- 继承该基类的业务类能持有定时器。
- 线程对象能够正常交互，比如线程 A 能够向线程 B 发送信号，线程 B 能够向线程 A 发送信号。

### 核心代码说明

`ThreadMsg` - 结构体类型 - **用于封装消息**。

| 变量名    | 含义                                                             |
|:----------|:---------------------------------------------------------------|
| `_signal` | `int` 类型 - 用于表示信号                                        |
| `_msg`    | `std::shared_ptr<void>` 类型 - 存储槽函数所需参数数据            |
| `_wait`   | `bool` 类型 - `_wait` 为 `true`，槽函数为同步运行，反之为异步运行。 |

`ThreadBase` 是一个基于 `std::thread` 的线程基类，用于处理消息队列（存储数据类型为 `ThreadMsg`），该类提供了以下功能函数：

| 函数名               | 作用                                                  |
|:---------------------|:----------------------------------------------------|
| `CreateThread`       | 创建工作线程                                          |
| `ExitThread`         | 退出工作线程                                          |
| `GetThreadID`        | 获取线程 ID                                           |
| `GetCurrentThreadID` | 获取当前线程 ID                                       |
| `UserCustomFunction` | 纯虚函数 - 派生类通过重写该函数将信号和槽函数绑定起来 |
| `SendMsg`            | 传递消息到消息队列中 - 异步或同步                     |
| `Process`            | 处理消息队列                                          |

## 测试

### 测试代码说明

`Human` 类继承自 `ThreadBase`，先定义所需的信号以及实现对应的槽函数，再通过重写 `UserCustomFunction` 函数，将信号和槽函数绑定起来，再编写一些可发送信号的 `public` 函数供外部调用。

### 测试驱动开发 TDD

使用 GoogleTest 做单元测试，测试所实现的线程能否达到设计期望。

## 日志检查

使用个 [PLOG](https://github.com/SergiusTheBest/plog) 开源库，实现日志记录。在 GoogleTest 单元测试的基础上，看日志判断线程是否按照设计期望正确运行着。
