[en-us](./README.md)

# CXX_Thread

## 设计期望

因该线程基类设计出来是为了替代 Qt 的 `QThread`，所以期望的功能如下：

- 信号与槽机制。主线程发送一个指令（即调用业务线程的公有成员函数），当业务线程接受到主线程某一个指令后，业务线程能根据该指令（公有函数内部调用发送封装了信号的消息给消息队列）去处理相对应的业务逻辑（处理消息队列，根据信号值去调用对应的槽函数或业务逻辑代码）。
- 继承该基类的派生业务类能持有定时器来做定时任务（异步执行）。
- 线程对象能够正常交互，比如线程 A 能够向线程 B 发送信号，线程 B 能够向线程 A 发送信号。

### 核心代码说明

`SignalMsg` - 结构体

| 变量名    | 含义                                                               |
| :-------- | :----------------------------------------------------------------- |
| `_wait`   | `bool` 类型 - 若 `_wait` 为 `true`，槽函数同步执行，反之异步执行。 |
| `_signal` | `int` 类型 - 用于表示信号                                          |
| `_msg`    | `std::shared_ptr<void>` 类型 - 存储槽函数所需的参数数据            |

`ThreadBase` 是一个基于 `std::thread` 的线程基类，用于处理消息队列（存储数据类型为 `SignalMsg`），该类提供了以下功能函数：

| 函数名                    | 作用                                                  |
| :------------------------ | :---------------------------------------------------- |
| `CreateThread`            | 创建工作线程                                          |
| `GetThreadID`             | 获取线程 ID                                           |
| `GetCurrentThreadID`      | 获取当前线程 ID                                       |
| `SendSlotFuncAsyncRunMsg` | 发送 `SignalMsg` 类型的对象，槽函数异步执行           |
| `SendSlotFuncSyncRunMsg`  | 发送 `SignalMsg` 类型的对象，槽函数同步执行           |
| `UserCustomFunction`      | 纯虚函数 - 派生类通过重写该函数将信号和槽函数绑定起来 |
| `SendMsg`                 | 生产者 - 往消息队列传递 `SignalMsg` 类型的对象        |
| `Process`                 | 消费者 - 消耗消息队列中 `SignalMsg` 类型的对象        |

`ThreadBase` 线程基类不支持拷贝、构造拷贝和 `Move` 行为。

## 测试

### 测试代码说明

`Human` 派生类继承自 `ThreadBase` 基类，先定义所需的信号，再实现对应信号的槽函数，通过重写 `UserCustomFunction` 函数，将信号和槽函数绑定起来；在派生类中编写一些可发送信号的 `public` 函数供外部调用（即主线程可访问）。

### 测试驱动开发 - TDD

使用 GoogleTest 做单元测试，测试所实现的线程能否达到设计期望。

## 日志检查

使用个 [PLOG](https://github.com/SergiusTheBest/plog) 开源库，实现日志记录。在 GoogleTest 单元测试的基础上，看日志判断线程是否按照设计期望正确运行着。
